<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		canvas{
			border:1px solid black;
		}
	</style>
</head>
<body>
	<canvas width="600" height="600"></canvas>
</body>
	<script>
	var canvas = document.querySelector("canvas");
	var ctx = canvas.getContext("2d");
	var arr = [];

	function Ball(x,y,r){
		var ball = this;
		ball.x = x;
		ball.y = y;
		ball.changeX = Math.random()*3;
		ball.changeY = Math.random()*4;
		ball.speedx = ball.changeX;
		ball.speedy = ball.changeY;
		ball.r = r;
		var num1 = Math.floor(Math.random()*255);
		var num2 = Math.floor(Math.random()*255);
		var num3 = Math.floor(Math.random()*255);

		ball.draw = function(){
			ctx.beginPath();
			ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);
			ctx.fillStyle = "rgb("+num1+","+num2+","+num3+")";
			ctx.fill();
			ctx.closePath()
		},
		ball.move = function(){
			ball.x += ball.speedx;
			ball.y += ball.speedy;

			if(ball.x<ball.r){
				ball.x = ball.r;
				ball.speedx = ball.changeX;
			}else if(ball.x>canvas.clientWidth-ball.r){
				ball.x = canvas.clientWidth-ball.r;
				ball.speedx = -ball.changeX;
			}
			if(ball.y<ball.r){
				ball.y = ball.r;
				ball.speedy = ball.changeY;
			}else if(ball.y>canvas.clientHeight-ball.r){
				ball.y = canvas.clientHeight-ball.r;
				ball.speedy = -ball.changeY;
			}
		}
	}

	

	setInterval(function(){
		ctx.clearRect(0,0,600,600);
		for(var i = 0;i<arr.length;i++){
			arr[i].draw();
			arr[i].move();
			
		}
		check();
	},10)
	

	document.onclick = function(){
		var ball = new Ball(20,20,Math.random()*20);
		arr.push(ball);
	}

	//0          5
	//1 2 3 4

	//1
	//2 3 4

	//2
	//3 4

	//3
	//4

	function check(){
		if(arr[1]){
			for(var i = 0;i<= arr.length-2;i++){
				for(var j = i+1;j<= arr.length-1;j++){
					var dx = arr[i].x - arr[j].x;
					var dy = arr[i].y - arr[j].y;
					var d = Math.sqrt((dx*dx)+(dy*dy));

					if(d < arr[i].r+arr[j].r){
						if(arr[i].x<arr[j].x){
							arr[i].speedx = -arr[j].changeX;
							arr[j].speedx = arr[i].changeX;
						}if(arr[i].x>arr[j].x){
							arr[i].speedx = arr[j].changeX;
							arr[j].speedx = -arr[i].changeX;
						}
						if(arr[i].y<arr[j].y){
							arr[i].speedy = -arr[j].changeY;
							arr[j].speedy = arr[i].changeY;
						}if(arr[i].y>arr[j].y){
							arr[i].speedy = arr[j].changeY;
							arr[j].speedy = -arr[i].changeY;
						}
						var px = arr[i].changeX;
						var py = arr[i].changeY;
						arr[i].changeX = arr[j].changeX;
						arr[i].changeY = arr[j].changeY;
						arr[j].changeX = px;
						arr[j].changeY = py;
 					}
				}
			}
		}
		
	}


	</script>
</html>
